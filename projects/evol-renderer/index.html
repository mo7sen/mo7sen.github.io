<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>evol-renderer - Robear Selwans' Portfolio</title><meta name=description content="The evol game engine's renderer module."><meta property="og:title" content="evol-renderer"><meta property="og:description" content="The evol game engine's renderer module."><meta property="og:type" content="article"><meta property="og:url" content="https://mo7sen.github.io/projects/evol-renderer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-31T13:25:00+00:00"><meta property="article:modified_time" content="2021-07-31T13:25:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="evol-renderer"><meta name=twitter:description content="The evol game engine's renderer module."><meta name=application-name content="Robear Selwans' Portfolio"><meta name=apple-mobile-web-app-title content="Robear Selwans' Portfolio"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mo7sen.github.io/projects/evol-renderer/><link rel=prev href=https://mo7sen.github.io/projects/evol-scripting/><link rel=next href=https://mo7sen.github.io/projects/evol-game/><link rel=stylesheet href=/css/page.min.css><link rel=stylesheet href=/css/home.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"evol-renderer","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mo7sen.github.io\/projects\/evol-renderer\/"},"genre":"posts","keywords":"Game Engine, Graphics","wordcount":985,"url":"https:\/\/mo7sen.github.io\/projects\/evol-renderer\/","datePublished":"2021-07-31T13:25:00+00:00","dateModified":"2021-07-31T13:25:00+00:00","publisher":{"@type":"Organization","name":"Robear Selwans"},"author":{"@type":"Person","name":"Robear Selwans"},"description":"The evol game engine's renderer module."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":""==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:""==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Robear Selwans' Portfolio">Robear Selwans' Portfolio</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/cv.pdf>CV </a><a class=menu-item href=/categories/project/>Projects </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Robear Selwans' Portfolio">Robear Selwans' Portfolio</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/cv.pdf title>CV</a><a class=menu-item href=/categories/project/ title>Projects</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><div class=menu-item><a href=javascript:void(0); class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single" data-toc=disable><div class=single-card><h2 class="single-title animated flipInX">evol-renderer</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://mo7sen.github.io/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Robear Selwans</a></span>&nbsp;<span class=post-category>published in <a href=/categories/project/><i class="far fa-folder fa-fw"></i>Project</a></span></div><div class=post-meta-line><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-07-31>2021-07-31</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;985 words</span>&nbsp;
<span><i class="far fa-clock fa-fw"></i>&nbsp;5 minutes</span>&nbsp;</div></div><hr><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#introduction>Introduction</a></li><li><a href=#implementation>Implementation</a></li></ul></li><li><a href=#things-to-add-in-the-future>Things to add in the future</a></li></ul></nav></div></div><div class=content id=content><h3 id=introduction>Introduction</h3><p>The rendering module is one of the more special modules; this is mainly because dependencies were kept to a minimum and extra effort was put to ensure that most of the module was actually built from scratch.</p><h3 id=implementation>Implementation</h3><p>For the graphics API, we used Vulkan. This decision was quite easy to take actually as DirectX wasn’t natively supported in linux and OpenGL wouldn’t provide any experience when it comes to newer graphics APIs which are way more verbose and provide more control over almost everything.</p><p>After playing around with Vulkan for a couple of months, we started to have more confidence in our understanding of the API and decided to start the implementation phase of the renderer. First, we created a thin abstraction layer of most of the Vulkan operations that we needed, and then we decided to look into how the renderer will communicate with the rest of the engine so that it knows what to render. Due to how the data was structured in the ECS module, sending a list of <code>RenderComponent</code>s and <code>TransformComponent</code>s was almost trivial. And thus was decided to be the main way to register objects for rendering in the next frame.</p><p>That’s when the time came for us to settle on what we wanted to have in our <code>RenderingComponent</code> structure. The first idea was to simply store all per-object rendering data inside that component and upload-draw-free each frame, it’s quite easy to see why that is a bad idea: GPU bandwidth from repeated uploads and frees of data, more memory usage to store the components, and way too many cache misses when iterating over the said components. The second idea was to simply upload the assets to the GPU memory and simply store handles to those assets in the <code>RenderComponent</code> (to be honest, this was the first idea but I just added the super naive one so that I can point out what is wrong with it.)</p><p>While the second option is way better than the first one (and is actually the option used in a lot of game engines until recently), it has one major flaw: too many API calls. Despite API calls being pretty cheap (especially on newer graphics APIs), having a lot of them can introduce some serious overhead. This is mitigated by using a “bindless” architecture, which minimizes the bindings needed per object so that only one binding is needed per object. The gist of this architecture is that instead of binding an asset, assets of the same type (buffers, images) are stored in an array on the GPU. The only binding needed then is for a structure that contains the indices needed by the current object. Those indices can then be used in the shaders to index the assets arrays and get the data easily.</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>The next steps are DrawIndirect and MultiDrawIndirect which further reduce the bindings and draw calls needed by allowing the GPU to get the data needed for a draw call from a GPU buffer, but we didn’t add those yet so I won’t be talking about them here.</div></div></div><p>While it was planned to have the rendering pipelines be generated from configuration files, and thus have a pretty flexible way to extend or create pipelines other than the ones provided in the engine by default. This has the added benefit of enabling us to try new rendering techniques without needing to refactor anything in the engine’s code. However, since this project had a deadline, there wasn’t enough time to get to that point and thus we settled on only keeping the built-in pipelines for now. While there are no custom pipelines, custom shaders that are compatible with the default pipelines can be provided by the user and easily compiled at runtime using <a href=https://github.com/google/shaderc target=_blank rel="noopener noreffer">libshaderc</a>.</p><p>Then, comes the shading. We started by having a simple forward shading approach. This allowed us to test most of the rendering logic in the most vanilla shading architecture. We decided to use the metallic-roughness PBR model and thus integrated it into the shaders and the materials. Then, after making sure that we are producing correct output, we decided to switch to deferred rendering for the sake of reducing the amount of overdraw that we were doing. Since we had the ability to define multiple built-in pipelines, we managed to keep both the forward shading and deferred shading supported at the same time (I should probably try benchmarking those two approaches so that we can have a better idea of how much performance gain we actually get.)</p><p>As for shadows, we decided to use shadow maps due to how simple they are to implement (which was crucial as we were nearing our deadline). We are planning to eventually check out how to integrate shadow volumes in the already existing structure, and then try researching more efficient ways to generate shadows as both of these approaches have their problems.</p><p>For antialiasing, we simply decided to settle on FXAA due to how simple it is to implement (a single full-screen pass) and we’re planning to explore more advanced approaches, like temporal anti-aliasing, at some point in the future.</p><h2 id=things-to-add-in-the-future>Things to add in the future</h2><p>Some of the things that are currently being considered to be added in the future:</p><ul><li>DrawIndirect/MultiDrawIndirect support</li><li>Configurable Pipelines</li><li>Ability to update assets without needing to upload all the assets all over again (This can probably be achieved through generational indexing and a way to get the next free cell in the asset array, for example a list of free cells)</li><li>Custom behaviour for objects that are not expected to change/move (static objects)</li><li>UI rendering (Will probably be done using imgui because of how modular it is and the possibility to generate Lua bindings for it and start playing with it in game scripts)</li><li>Replace the deferred shading’s G-Buffer with a visibility buffer</li><li>Add an alpha pass to allow the rendering of translucent objects</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-tag><span><a href=/tags/game-engine/>Game Engine</a>
</span><span><a href=/tags/graphics/>Graphics</a></span></div><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-07-31</span></div><div class=post-info-mod></div></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://mo7sen.github.io/projects/evol-renderer/ data-title=evol-renderer data-hashtags="Game Engine,Graphics"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://mo7sen.github.io/projects/evol-renderer/ data-hashtag="Game Engine"><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://mo7sen.github.io/projects/evol-renderer/><i class="fab fa-reddit fa-fw"></i></a></span></div></div><div class=post-nav><a href=/projects/evol-scripting/ class=prev rel=prev title=evol-scripting><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
<a href=/projects/evol-game/ class=next rel=next title=evol-game>Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://mo7sen.github.io/about>Robear Selwans</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-chevron-up fa-fw"></i></a></div><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script src=/lib/lazysizes/lazysizes.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script src=/lib/sharer/sharer.min.js></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script src=/js/theme.min.js></script></body></html>