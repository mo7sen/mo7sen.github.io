<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>evol-assetmanager - Robear Selwans' Portfolio</title><meta name=description content="The evol game engine's asset-manager module."><meta property="og:title" content="evol-assetmanager"><meta property="og:description" content="The evol game engine's asset-manager module."><meta property="og:type" content="article"><meta property="og:url" content="https://mo7sen.github.io/projects/evol-assetmanager/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-31T13:25:00+00:00"><meta property="article:modified_time" content="2021-07-31T13:25:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="evol-assetmanager"><meta name=twitter:description content="The evol game engine's asset-manager module."><meta name=application-name content="Robear Selwans' Portfolio"><meta name=apple-mobile-web-app-title content="Robear Selwans' Portfolio"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mo7sen.github.io/projects/evol-assetmanager/><link rel=prev href=https://mo7sen.github.io/projects/evol-core/><link rel=next href=https://mo7sen.github.io/projects/evol-architecture/><link rel=stylesheet href=/css/page.min.css><link rel=stylesheet href=/css/home.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"evol-assetmanager","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mo7sen.github.io\/projects\/evol-assetmanager\/"},"genre":"posts","keywords":"Game Engine","wordcount":452,"url":"https:\/\/mo7sen.github.io\/projects\/evol-assetmanager\/","datePublished":"2021-07-31T13:25:00+00:00","dateModified":"2021-07-31T13:25:00+00:00","publisher":{"@type":"Organization","name":"Robear Selwans"},"author":{"@type":"Person","name":"Robear Selwans"},"description":"The evol game engine's asset-manager module."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":""==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:""==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Robear Selwans' Portfolio">Robear Selwans' Portfolio</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/cv.pdf>CV </a><a class=menu-item href=/categories/project/>Projects </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/tags/>Tags </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Robear Selwans' Portfolio">Robear Selwans' Portfolio</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/cv.pdf title>CV</a><a class=menu-item href=/categories/project/ title>Projects</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/tags/ title>Tags</a><div class=menu-item><a href=javascript:void(0); class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single" data-toc=disable><div class=single-card><h2 class="single-title animated flipInX">evol-assetmanager</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://mo7sen.github.io/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Robear Selwans</a></span>&nbsp;<span class=post-category>published in <a href=/categories/project/><i class="far fa-folder fa-fw"></i>Project</a></span></div><div class=post-meta-line><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-07-31>2021-07-31</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;452 words</span>&nbsp;
<span><i class="far fa-clock fa-fw"></i>&nbsp;3 minutes</span>&nbsp;</div></div><hr><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#mounts>Mounts</a></li><li><a href=#filewatch>Filewatch</a></li><li><a href=#storage>Storage</a></li><li><a href=#asset-loading>Asset Loading</a></li></ul></nav></div></div><div class=content id=content><p>The asset managers try to provide some features that make the workflow of
adding/using assets less painful. While there is no fancy features like
asynchronous loading or callbacks, the base foundation of the asset manager is
quite flexible and allows the addition of such features in the future.</p><h2 id=mounts>Mounts</h2><p>Ok, so it&rsquo;s probably not the best idea to start this off with a QoL feature, but
it&rsquo;s too fun to leave for later. The feature is basically virtual mounting of
folders (or ZIP files) to a specific mount point so that items in that folder
can be referenced relative to the mount point. For example, a user can specify
the directory at which the shaders reside in the <em>game.proj</em> file like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;mounts&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;./assets/shaders&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mountpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;shaders&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>This way, the default fragment shader can then be referenced as
<code>shaders://default.frag</code>, which would be pretty useful when dealing with long
paths. We got inspired to add this feature when <a href=https://github.com/ObEngine/ObEngine target=_blank rel="noopener noreffer">Ã–bEngine</a>
added it and thought that it&rsquo;d be a nice-to-have.</p><h2 id=filewatch>Filewatch</h2><p>Another feature was the ability to monitor mounted directories. This allowed the
dispatching of events whenever an asset is changed which, in turn, allowed the
automatic reloading of said assets. This was used to enable hotloading for
scenes, shaders and scripts.</p><h2 id=storage>Storage</h2><p>Assets are stored in an ECS world, which might seem counter-intuitive but was
actually found to be quite efficient when operations need to be made on all the
assets, like the lifetime counter. While all assets are reference-counted,
assets that are used frequently by a single entity will just keep on being
loaded and unloaded each frame. To avoid that, a lifetime counter was added that
gets decremented each frame whenever the reference-count is 0. By setting the
lifetime of assets to 2 by default, assets can now survive for 2 frames after
their reference-count reaches zero, then they&rsquo;re freed.</p><h2 id=asset-loading>Asset Loading</h2><p>The assets are loaded first as generic binary files and handles are returned.
After that, those handles can be passed to a loader so that it can return an
object that interprets that binary as a specific asset type. The currently
implemented loaders are:</p><ul><li><strong>Mesh Loader</strong>: Interprets the binary as our own mesh format and extracts all
the data from it</li><li><strong>Image Loader</strong>: Interprets the binary as our own image format and extracts
all the data from it</li><li><strong>Shader Loader</strong>: Interprets the binary as a GLSL shader and compiles it to
SPIR-V using shaderc.</li><li><strong>JSON Loader</strong>: Interprets the binary as a JSON file, parses it, and returns
our very own evjson context.</li><li><strong>Text Loader</strong>: Interprets the binary as a simple text file and puts it in a
dynamic string (evstring)</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-tag><span><a href=/tags/game-engine/>Game Engine</a></span></div><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-07-31</span></div><div class=post-info-mod></div></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://mo7sen.github.io/projects/evol-assetmanager/ data-title=evol-assetmanager data-hashtags="Game Engine"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://mo7sen.github.io/projects/evol-assetmanager/ data-hashtag="Game Engine"><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://mo7sen.github.io/projects/evol-assetmanager/><i class="fab fa-reddit fa-fw"></i></a></span></div></div><div class=post-nav><a href=/projects/evol-core/ class=prev rel=prev title=evol-core><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
<a href=/projects/evol-architecture/ class=next rel=next title="evol Architecture">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://mo7sen.github.io/about>Robear Selwans</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-chevron-up fa-fw"></i></a></div><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script src=/lib/lazysizes/lazysizes.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script src=/lib/sharer/sharer.min.js></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script src=/js/theme.min.js></script></body></html>